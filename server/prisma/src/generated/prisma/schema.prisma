model User {
  id             Int            @id @default(autoincrement())
  username       String
  email          String         @unique
  password_hash  String
  is_active      Boolean
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
  last_login_at  DateTime       @default(now())
  role           Role
  leads          Lead[]
  leadActivities LeadActivity[]
  notifications  Notification[]
  sessions       Sessions[]
}

model Sessions {
  id            Int      @id @default(autoincrement())
  session_token String   @unique
  ip_address    String
  user_agent    String
  created_at    DateTime @default(now())
  expires_at    DateTime
  revoked_at    DateTime
  user_id       Int
  user          User     @relation(fields: [user_id], references: [id])
}

enum Role {
  Admin
  Owner
  Sales
  Finance
}

model Contact {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String?
  email     String?  @unique
  phone     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  leads     Lead[]
}

model Lead {
  id                Int            @id @default(autoincrement())
  title             String?
  quotationAmount   Float?         @default(0)
  clientBudget      Float
  status            String         @default("New")
  probability       Int?           @default(0)
  expectedCloseDate DateTime?
  notes             String?
  guests            Int?
  venue             String?
  eventType         String?
  eventDate         DateTime?
  finalAmount       Float?
  advanceAmount     Float?
  siteVisitDate     DateTime?
  siteVisitTime     String?
  bookingNotes      String?
  bookedAt          DateTime?
  bookedBy          String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  contactId         Int
  sourceId          Int?
  assignedTo        Int?
  assignee          User?          @relation(fields: [assignedTo], references: [id])
  contact           Contact        @relation(fields: [contactId], references: [id])
  source            Sources?       @relation(fields: [sourceId], references: [id])
  activities        LeadActivity[]
  notifications     Notification[]
  payments          Payment[]
}

model Payment {
  id        Int      @id @default(autoincrement())
  amount    Float
  date      DateTime @default(now())
  type      String   @default("Payment")
  notes     String?
  leadId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
}

model LeadActivity {
  id        Int      @id @default(autoincrement())
  leadId    Int
  userId    Int?
  type      String   @default("NOTE")
  content   String
  createdAt DateTime @default(now())
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id])
}

model Sources {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  leads     Lead[]
}

model Notification {
  id         Int      @id @default(autoincrement())
  type       String
  message    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  userId     Int?
  leadId     Int?
  priority   String   @default("normal")
  assignedTo String?
  lead       Lead?    @relation(fields: [leadId], references: [id])
  user       User?    @relation(fields: [userId], references: [id])
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model AppSetting {
  key       String   @id
  value     Json
  updatedAt DateTime @updatedAt
}
